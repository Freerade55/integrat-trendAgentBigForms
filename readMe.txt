
Файлы, которые принимают веб-хуки
///////////////
big_form.php - принимает реквест с форм регистрации ип, ооо и тд, под разными условиями делает интеграцию в амо

task_on_company.php - хук с амо на смену ответственного, делает задачу о смене ответственного

hook_company.php - хук на добавление компании, частично заполняет таблицу auto_tasks этой компанией

hook_task.php - хук на изменение задачи, если задача закрыта, то заполняет ее в hook_task
///////////////////////////


Файлы, которые исполняются на кроне
//////////////////////////////
cron_lead_recon.php - берет из таблицы hook_lead_recon сделки со статусом unset, ищет компанию на этой сделке, если находит, то заполняет дату last_lead_recon, first_lead_recon если дата первой сделки не заполнена, то заполняем её датой текущей сверки, если дата второй сверки не заполнена, сравниваем месяц даты из f_l_r с месяцем даты текущей сверки, от результата записываются поля recon - в конце в любом случае в таблицу hook_lead_recon lead_status = set, даже если при сверке не было обнаружено компании у сделки

cron_check_last_recon.php - вытаскивает из таблицы компании с заполненной датой последней сверки (сверка - поиск прикрепленной компании на лиде, происходит в файле cron_lead_recon.php) и со статусом unset, если разница между текущей датой и датой последней сверки больше чем 60 дней, то ставим задачу на компанию и в last_lead_recon_status ставим set 5184000 секунд - 60 дней


cron_check_2month_recon.php - вытаскиваем из таблицы компании с заполненной датой второй сверки и со статусом unset, если разница между текущей датой и датой второй сверки больше чем 30 дней, то ставим задачу на компанию и в two_month_lead_recon_status ставим set 2592000 секунд - 43200 минут - 30 дней


cron_check_last_recon.php - вытаскиваем из таблицы компании с заполненной датой последней сверки и со статусом unset. Если разница между текущей датой и датой последней сверки больше чем 60 дней, то ставим задачу на компанию и в last_lead_recon_status ставим set 5184000 секунд - 60 дней



cron_check_last_task.php - вытаскиваем из таблицы компании с заполненной датой последней задачи и со статусом unset, если разница между текущей датой и датой последней задачи с результатом больше, чем 30 дней, то ставим задачу на компанию и в last_task_status ставим set 2592000 секунд - 43200 минут - 30 дней. Если разница больше месяца и меньше двух месяцев, и локация компании не Москва, то ставим задачу. Если разница больше двух месяцев, и локация компании Москва, то ставим задачу


cron_task.php - вытаскиваем из таблицы hook_task задачи со статусом unset, если у задачи имеется текст-результат, то ищем строку (одну) в таблице компаний с company_id таким же как в element_id задачи, в столбец last_task_with_result ставим дату последней задачи с результатом, для той компании, id которой был указан в задаче



